<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>APUSH Unit 5 Clicker</title>
  <style>
    :root {
      --bg:#0b1220; --card:#111a2e; --muted:#a9b5d9; --text:#eef1fb;
      --accent:#7aa2ff; --accent-2:#66e3c4; --danger:#ff7a7a; --gold:#ffd166;
      --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px;
      --target-size:56px; --target-pad:10px; --move-ms:260ms;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:radial-gradient(1000px 600px at 15% 10%, #0f1830 0%, var(--bg) 50%),
                        radial-gradient(800px 500px at 85% 20%, #0c1a33 0%, var(--bg) 50%);
         color:var(--text);font:16px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:16px}
    h1{font-size:28px;margin:0}.subtitle{color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:1.4fr .9fr .7fr;gap:16px}
    @media (max-width:920px){.grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),transparent);
          border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow)}
    .card .head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06)}
    .card .body{padding:16px}

    .click-area{position:relative;width:100%;aspect-ratio:1/1;border-radius:24px;
      background:radial-gradient(200px 200px at 30% 25%, rgba(255,255,255,.12), transparent 60%),
                 linear-gradient(180deg,#1a2a53,#121d3a);
      box-shadow:0 20px 60px rgba(0,0,0,.5), inset 0 0 0 2px rgba(255,255,255,.06);
      overflow:hidden}

    .target{position:absolute;width:var(--target-size);height:var(--target-size);border-radius:50%;
      background:
        radial-gradient(140% 140% at 30% 25%,
          rgba(255,255,255,.35) 0%,
          rgba(255,255,255,.16) 36%,
          rgba(255,255,255,.08) 58%,
          rgba(255,255,255,0) 78%),
        linear-gradient(180deg,#7aa2ff,#4f7ef0);
      background-clip:padding-box;color:#0b1124;display:flex;align-items:center;justify-content:center;font-weight:900;cursor:pointer;user-select:none;
      transition:left var(--move-ms) cubic-bezier(.2,.8,.2,1), top var(--move-ms) cubic-bezier(.2,.8,.2,1), transform .06s ease, filter .15s ease;
      box-shadow:0 10px 28px rgba(0,0,0,.45), inset 0 0 0 2px rgba(255,255,255,.22)}
    .target:hover{filter:brightness(1.08)} .target:active{transform:scale(.97)}

    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.1);padding:8px 10px;border-radius:999px;background:rgba(255,255,255,.03);font-size:13px;color:var(--muted)}
    .pill strong{color:var(--text)}
    .btn{border:none;border-radius:12px;padding:10px 12px;font-weight:700;cursor:pointer;transition:filter .15s, transform .06s}
    .btn:hover{filter:brightness(1.08)} .btn:active{transform:translateY(1px)}
    .btn.gold{background:linear-gradient(180deg,#f7d36f,#d8aa39);color:#281a00}
    .btn.accent{background:linear-gradient(180deg,#7aa2ff,#4f7ef0);color:#0c1330}
    .btn.alt{background:linear-gradient(180deg,#66e3c4,#35c2a2);color:#06241b}

    .list{display:flex;flex-direction:column;gap:10px}
    .item{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px;border-radius:14px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06)}
    .item .meta{display:flex;flex-direction:column;gap:2px}.item .title{font-weight:700}.item .note{font-size:12px;color:var(--muted)}

    .meter{height:10px;width:100%;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden}
    .meter>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-2))}
    .money{font-size:24px;font-weight:900}
    .small{font-size:12px;color:var(--muted)}

    dialog{border:none;border-radius:18px;width:min(560px,92%);background:var(--card);color:var(--text);box-shadow:var(--shadow)}
    dialog::backdrop{background:rgba(5,10,20,.6)}
    .modal-head{padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;justify-content:space-between;align-items:center}
    .modal-body{padding:16px}

    .choices{display:grid;gap:10px;margin-top:10px}
    .choice{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.18);
      padding:10px 12px;border-radius:12px;cursor:pointer;color:var(--text);
      transition:background .15s,border-color .15s,transform .05s}
    .choice:hover{background:rgba(255,255,255,.12);border-color:rgba(255,255,255,.28);transform:translateY(-1px)}
    .choice.correct{border-color:var(--accent-2);background:rgba(102,227,196,.15)}
    .choice.wrong{border-color:var(--danger);background:rgba(255,122,122,.12)}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>APUSH Unit 5 Clicker</h1>
      <div class="subtitle">Earn <strong>USD</strong> by clicking, buying upgrades, and answering Unit 5 questions (1844‚Äì1877).</div>
    </div>
    <div class="row">
      <button id="saveBtn" class="btn alt">üíæ Save</button>
      <button id="prestigeBtn" class="btn gold">üåÄ Prestige</button>
    </div>
  </header>

  <div class="grid">
    <section class="card">
      <div class="head">
        <div class="row">
          <div>
            <div id="currency" class="money">$0</div>
            <div class="subtitle">Dollars</div>
          </div>
          <div class="pill"><span>üñ±Ô∏è $/Click:</span><strong id="ppc">1</strong></div>
          <div class="pill"><span>‚è±Ô∏è $/s:</span><strong id="pps">0</strong></div>
          <div class="pill"><span>‚ö° Mult:</span><strong id="mult">1√ó</strong></div>
          <div class="pill"><span>‚ú® Prestige:</span><strong id="prestige">0 (√ó1)</strong></div>
        </div>
      </div>
      <div class="body">
        <div id="clickArea" class="click-area">
          <button id="targetBtn" class="target" aria-label="Click for money">$</button>
        </div>
        <p class="small" style="margin-top:10px;">Click the moving target to earn money.</p>
        <div class="row" style="margin-top:10px;">
          <button id="boostBtn" class="btn gold">üéÅ Quiz Boost</button>
          <span id="boostTimer" class="pill">‚è≥ Boost: <strong>‚Äî</strong></span>
        </div>
        <div style="margin-top:10px;">
          <div class="meter"><div id="progressBar"></div></div>
          <div class="small muted" id="nextGoal">Goal: Reach $100,000,000</div>
        </div>
      </div>
    </section>

    <section class="card"><div class="head"><strong>Upgrades</strong></div><div class="body"><div id="upgradeList" class="list"></div></div></section>
    <section class="card"><div class="head"><strong>Producers</strong></div><div class="body"><div id="producerList" class="list"></div></div></section>
  </div>
</div>

<dialog id="quizModal" aria-labelledby="quizTitle" aria-describedby="quizDesc">
  <div class="modal-head">
    <strong id="quizTitle">Answer a Unit 5 question</strong>
    <button id="closeQuiz" class="btn">‚úñ</button>
  </div>
  <div class="modal-body">
    <div id="quizDesc" class="small">Get the answer right to pick a reward.</div>
    <h3 id="qText" style="margin:.6em 0 .4em"></h3>
    <div id="qChoices" class="choices" role="list"></div>
    <div class="footer" style="margin-top:10px;text-align:right;">
      <button id="rerollBtn" class="btn alt">üîÅ New Question</button>
    </div>
  </div>
</dialog>

<script>
window.addEventListener('DOMContentLoaded', () => {
  const $ = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);

  const STORAGE_OK = (()=>{ try{ const t='__apush5__'; localStorage.setItem(t,'1'); localStorage.removeItem(t); return true; }catch(_){ return false; } })();

  const BASE_TARGET_SIZE = 56; // px
  const state = {
    points: 0, basePpc: 1, ppcMult: 1, pps: 0,
    goal: 100000000, prestige: 0, endless: false,
    upgrades: [], producers: [],
    boostEndsAt: 0, lastTick: performance.now()
  };

  /* ---------- Pricing ---------- */
  const pow = Math.pow;
  function ppcCost(level){
    const base = 50;
    if(level <= 3) return Math.floor(base * pow(1.55, level));
    if(level === 4){ const prev = Math.floor(base * pow(1.55, 3)); return prev * 4; }
    return Infinity;
  }
  function sizeCost(level){ const base = 350; return Math.floor(base * pow(2.1, level)); }
  function priceProducer(base, n){ return Math.floor(base * Math.pow(1.55, n)); }

  /* ---------- Catalogs ---------- */
  const UPGRADE_DATA = [
    { id:'ppc',  name:'PPC Upgrade',   desc:'+1 $/Click (final jumps to $10)', type:'ppc',  max:5,  costFn: ppcCost },
    { id:'size', name:'Target Size',   desc:'+10% button size',                type:'size', max:10, costFn: sizeCost }
  ];
  const PRODUCER_DATA = [
    { id:'pamphleteers',   name:'Abolitionist Pamphleteers', basePps:0.05, baseCost:200 },
    { id:'republican-clubs', name:'Republican Clubs',        basePps:0.2,  baseCost:1500 }
  ];

  const QUIZ = [
    {q:'What concept justified U.S. expansion to the Pacific?', c:['Containment','Manifest Destiny','Isolationism','Popular Sovereignty'], a:1},
    {q:'Which war was sparked in part by the annexation of Texas?', c:['Spanish-American War','War of 1812','Mexican‚ÄìAmerican War','Civil War'], a:2},
    {q:"Lincoln's Ten Percent Plan aimed to...", c:['punish Confederates severely','require majority loyalty oaths','offer lenient readmission for states','delay readmission until 1900'], a:2},
    {q:'Which amendment abolished slavery?', c:['13th','14th','15th','16th'], a:0},
    {q:'The Compromise of 1877 resulted in...', c:['renewed Radical Reconstruction','federal troops withdrawn from the South','immediate Black suffrage','annexation of Cuba'], a:1},
  ];

  /* ---------- Persistence ---------- */
  function save(){ if(!STORAGE_OK) return; try{ localStorage.setItem('apush5-save', JSON.stringify(state)); }catch(e){ console.warn('save failed', e); } }
  function load(){
    if(!STORAGE_OK) return;
    const raw = localStorage.getItem('apush5-save'); if(!raw) return;
    try{ Object.assign(state, JSON.parse(raw)); }catch(e){ console.warn('load failed', e); }
  }

  /* ---------- Migration (adds new upgrades/producers to old saves) ---------- */
  function migrate(){
    // Upgrades: ensure every catalog item exists; keep existing levels
    const byId = Object.fromEntries((state.upgrades||[]).map(u=>[u.id,u]));
    const merged = UPGRADE_DATA.map(def => byId[def.id] ? {...def, ...byId[def.id]} : {...def, level:0});
    state.upgrades = merged;

    // Producers: same pattern
    const pById = Object.fromEntries((state.producers||[]).map(p=>[p.id,p]));
    const pMerged = PRODUCER_DATA.map(def => pById[def.id] ? {...def, ...pById[def.id]} : {...def, level:0});
    state.producers = pMerged;

    // Apply size if present in save
    applyTargetSizeFromLevel();
  }

  /* ---------- DOM ---------- */
  const moneyEl=$('#currency'), ppcEl=$('#ppc'), ppsEl=$('#pps'), multEl=$('#mult'), prestigeEl=$('#prestige');
  const progressBar=$('#progressBar'), nextGoalEl=$('#nextGoal'), boostTimer=$('#boostTimer strong');
  const upgradeList=$('#upgradeList'), producerList=$('#producerList');

  const clickArea=$('#clickArea'), targetBtn=$('#targetBtn');
  const boostBtn=$('#boostBtn'), quizModal=$('#quizModal'), closeQuiz=$('#closeQuiz'), rerollBtn=$('#rerollBtn');
  const qText=$('#qText'), qChoices=$('#qChoices');

  const saveBtn=$('#saveBtn'), prestigeBtn=$('#prestigeBtn');

  /* ---------- Init content ---------- */
  function initContent(){
    if(!state.upgrades.length)  state.upgrades  = UPGRADE_DATA.map(u=>({...u, level:0}));
    if(!state.producers.length) state.producers = PRODUCER_DATA.map(p=>({...p, level:0}));
    applyTargetSizeFromLevel();
  }

  /* ---------- HUD ---------- */
  function fmt(n){ if(n>=1e9) return '$'+(n/1e9).toFixed(2)+'B';
                   if(n>=1e6) return '$'+(n/1e6).toFixed(2)+'M';
                   if(n>=1e3) return '$'+(n/1e3).toFixed(2)+'k';
                   return '$'+Math.floor(n); }

  function updateHUD(){
    moneyEl.textContent = fmt(state.points);
    ppcEl.textContent   = fmt(state.basePpc * state.ppcMult);
    ppsEl.textContent   = '$' + state.pps.toFixed(2);
    multEl.textContent  = state.ppcMult.toFixed(1)+'√ó';
    prestigeEl.textContent = `${state.prestige} (√ó${state.prestige+1})`;
    const prog = Math.max(0, Math.min(1, state.points / state.goal));
    progressBar.style.width = (prog*100).toFixed(1)+'%';
    nextGoalEl.textContent = state.endless
      ? 'Endless mode unlocked! Keep going. Prestige for +1√ó permanent boost.'
      : `Goal: Reach ${fmt(state.goal)}`;
  }

  /* ---------- Upgrades ---------- */
  function upgradeCost(u){ return u.type==='ppc' ? ppcCost(u.level) : u.type==='size' ? sizeCost(u.level) : Infinity; }

  function applyTargetSizeFromLevel(){
    const u = (state.upgrades||[]).find(x=>x.id==='size');
    const lvl = u?.level || 0;
    const factor = 1 + 0.10 * lvl; // +10% per level
    const px = Math.round(BASE_TARGET_SIZE * factor);
    document.documentElement.style.setProperty('--target-size', px+'px');
  }

  function buyUpgrade(u){
    if(u.level >= u.max) return;
    const cost = upgradeCost(u);
    if(state.points < cost) return;
    state.points -= cost;

    if(u.type === 'ppc'){
      if(u.level < 4){ state.basePpc += 1; }
      else if(u.level === 4){ state.basePpc += 5; } // jump to $10
      u.level++;
    } else if(u.type === 'size'){
      u.level++;
      applyTargetSizeFromLevel();
    }

    updateHUD(); renderUpgrades(); save();
  }

  function renderUpgrades(){
    upgradeList.innerHTML='';
    state.upgrades.forEach(u=>{
      const atMax = u.level >= u.max;
      const cost = upgradeCost(u);
      let nextLabel;
      if(u.type==='ppc') nextLabel = u.level < 4 ? '+1 $/Click' : (u.level===4 ? 'Jump to $10/Click' : 'Max');
      else nextLabel = u.level < u.max ? '+10% size' : 'Max';

      const div = document.createElement('div');
      div.className='item';
      div.innerHTML = `<div class="meta"><div class="title">${u.name}</div>
        <div class="note">${nextLabel} ‚Ä¢ Owned: ${u.level}/${u.max} ‚Ä¢ ${atMax ? 'MAX' : 'Cost: '+fmt(cost)}</div></div>`;

      const btn = document.createElement('button');
      btn.className='btn accent';
      btn.textContent = atMax ? 'Maxed' : 'Buy';
      btn.disabled = atMax || state.points < cost;
      btn.addEventListener('click', ()=> buyUpgrade(u));

      div.appendChild(btn);
      upgradeList.appendChild(div);
    });
  }

  /* ---------- Producers ---------- */
  function recomputePPS(){ state.pps = state.producers.reduce((s,p)=>s + p.basePps*p.level, 0); }
  function renderProducers(){
    producerList.innerHTML='';
    state.producers.forEach(p=>{
      const cost = priceProducer(p.baseCost, p.level);
      const div = document.createElement('div');
      div.className='item';
      div.innerHTML = `<div class="meta"><div class="title">${p.name}</div>
        <div class="note">+${p.basePps.toFixed(2)} $/s each ‚Ä¢ Owned: ${p.level} ‚Ä¢ Cost: ${fmt(cost)}</div></div>`;
      const btn = document.createElement('button');
      btn.className='btn'; btn.textContent='Hire'; btn.disabled = state.points < cost;
      btn.addEventListener('click', ()=>{
        if(state.points < cost) return;
        state.points -= cost; p.level++; recomputePPS();
        updateHUD(); renderProducers(); save();
      });
      div.appendChild(btn); producerList.appendChild(div);
    });
  }

  function refreshAffordability(){
    $$('#upgradeList .item').forEach((el,i)=>{
      const u = state.upgrades[i];
      const atMax = u.level >= u.max;
      const c = upgradeCost(u);
      const note = el.querySelector('.note');
      const nextLabel = (u.type==='ppc')
        ? (u.level < 4 ? '+1 $/Click' : (u.level===4 ? 'Jump to $10/Click' : 'Max'))
        : (u.level < u.max ? '+10% size' : 'Max');
      note.textContent = `${nextLabel} ‚Ä¢ Owned: ${u.level}/${u.max} ‚Ä¢ ${atMax ? 'MAX' : 'Cost: '+fmt(c)}`;
      const btn = el.querySelector('button');
      btn.textContent = atMax ? 'Maxed' : 'Buy';
      btn.disabled = atMax || state.points < c;
    });

    $$('#producerList .item').forEach((el,i)=>{
      const p = state.producers[i];
      const c = priceProducer(p.baseCost, p.level);
      el.querySelector('button').disabled = state.points < c;
      el.querySelector('.note').textContent = `+${p.basePps.toFixed(2)} $/s each ‚Ä¢ Owned: ${p.level} ‚Ä¢ Cost: ${fmt(c)}`;
    });
  }

  /* ---------- Goal / Endless ---------- */
  function checkGoal(){
    if(state.points >= state.goal){
      if(state.goal >= 100000000){ state.endless = true; }
      else { state.goal = Math.floor(state.goal * 2.7); }
    }
  }

  /* ---------- Moving target ---------- */
  function moveTarget(){
    const a = clickArea.getBoundingClientRect();
    const s = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--target-size')) || BASE_TARGET_SIZE;
    const p = 10;
    const x = p + Math.random() * Math.max(0, a.width  - s - p);
    const y = p + Math.random() * Math.max(0, a.height - s - p);
    targetBtn.style.left = x + 'px'; targetBtn.style.top = y + 'px';
  }
  new ResizeObserver(()=>moveTarget()).observe(clickArea);

  targetBtn.addEventListener('click', ()=>{
    const gain = state.basePpc * state.ppcMult * (state.prestige + 1);
    state.points += gain; checkGoal(); updateHUD(); refreshAffordability(); moveTarget(); save();
  });
  targetBtn.addEventListener('keydown', (e)=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); targetBtn.click(); }});

  /* ---------- Quiz (with rewards) ---------- */
  let currentQ = null, rewarded = false;

  function pickQuestion(){
    currentQ = QUIZ[Math.floor(Math.random()*QUIZ.length)];
    rewarded = false;
    qText.textContent = currentQ.q;
    qChoices.innerHTML = '';
    currentQ.c.forEach((text, idx)=>{
      const btn = document.createElement('button');
      btn.type='button'; btn.className='choice';
      btn.innerHTML = `<span class="pill">${String.fromCharCode(65+idx)}</span> <span>${text}</span>`;
      btn.addEventListener('click', ()=> handleAnswer(idx, btn));
      qChoices.appendChild(btn);
    });
  }

  function handleAnswer(idx, el){
    if(rewarded) return;
    const correct = idx === currentQ.a;
    $$('.choice').forEach(b=> b.disabled=true);
    if(correct){
      el.classList.add('correct'); showRewardChooser(); rewarded = true;
    }else{
      el.classList.add('wrong');
      const msg = document.createElement('div');
      msg.className='small'; msg.style.marginTop='8px';
      msg.textContent='Not quite. Reroll or close and try again.';
      qChoices.appendChild(msg);
    }
  }

  function showRewardChooser(){
    const wrap = document.createElement('div'); wrap.style.marginTop='12px';
    wrap.innerHTML = `<div class="small">Nice! Pick your reward:</div>`;
    const row = document.createElement('div'); row.className='row'; row.style.marginTop='8px';
    const r1 = document.createElement('button'); r1.className='btn gold';   r1.textContent='2√ó $/Click for 60s';
    const r2 = document.createElement('button'); r2.className='btn accent'; r2.textContent='Free cheapest upgrade';
    r1.addEventListener('click', ()=>{ startBoost(60); quizModal.close(); });
    r2.addEventListener('click', ()=>{ grantFreeUpgrade(); quizModal.close(); });
    row.appendChild(r1); row.appendChild(r2); wrap.appendChild(row); qChoices.appendChild(wrap);
  }

  function startBoost(seconds){
    state.ppcMult = 2;
    state.boostEndsAt = performance.now() + seconds*1000;
    $('#boostTimer strong').textContent = seconds+'s';
    updateHUD(); save();
  }

  function grantFreeUpgrade(){
    const candidates = state.upgrades
      .filter(u=> u.level < u.max)
      .map(u=> ({u, cost: upgradeCost(u)}))
      .sort((a,b)=> a.cost - b.cost);
    if(!candidates.length) return;
    const chosen = candidates[0].u;
    if(chosen.type === 'ppc'){
      if(chosen.level < 4){ state.basePpc += 1; }
      else if(chosen.level === 4){ state.basePpc += 5; }
      chosen.level++;
    } else if(chosen.type === 'size'){
      chosen.level++;
      applyTargetSizeFromLevel();
    }
    renderUpgrades(); updateHUD(); save();
  }

  $('#boostBtn').addEventListener('click', ()=>{ pickQuestion(); $('#quizModal').showModal(); });
  $('#closeQuiz').addEventListener('click', ()=> $('#quizModal').close());
  $('#rerollBtn').addEventListener('click', pickQuestion);

  /* ---------- Prestige ---------- */
  function canPrestige(){ return state.points >= 100000000 || state.endless; }
  function doPrestige(){
    if(!canPrestige()) return;
    if(!confirm('Prestige? Reset progress for a permanent +1√ó currency multiplier.')) return;
    state.prestige = (state.prestige||0) + 1;
    state.points=0; state.basePpc=1; state.ppcMult=1; state.pps=0;
    state.boostEndsAt=0; state.endless=false; state.goal=100000000;
    state.upgrades.forEach(u=>u.level=0);
    state.producers.forEach(p=>p.level=0);
    applyTargetSizeFromLevel();
    recomputePPS(); renderUpgrades(); renderProducers(); updateHUD(); moveTarget(); save();
  }
  $('#prestigeBtn').addEventListener('click', doPrestige);

  /* ---------- Loop & save ---------- */
  function recomputePPS(){ state.pps = state.producers.reduce((s,p)=>s + p.basePps*p.level, 0); }
  function renderProducers(){ /* filled above */ } // defined earlier
  const _renderProducers = renderProducers; // keep reference

  function tick(){
    const now = performance.now();
    const dt = Math.min(1, (now - state.lastTick)/1000);
    state.lastTick = now;

    state.points += state.pps * dt * (state.prestige + 1);

    if(state.boostEndsAt > 0){
      const remaining = Math.max(0, Math.ceil((state.boostEndsAt - now)/1000));
      $('#boostTimer strong').textContent = remaining ? (remaining+'s') : '‚Äî';
      if(!remaining){ state.ppcMult = 1; state.boostEndsAt = 0; }
    }

    checkGoal(); updateHUD(); refreshAffordability();
    requestAnimationFrame(tick);
  }

  /* ---------- Boot ---------- */
  load();           // 1) load old save
  initContent();    // 2) ensure arrays exist
  migrate();        // 3) merge in any new upgrades/producers
  recomputePPS();
  renderUpgrades();
  _renderProducers(); // call the actual function
  updateHUD(); moveTarget();

  if(STORAGE_OK){
    setInterval(save,15000);
    window.addEventListener('beforeunload', save);
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) save(); });
  }
  requestAnimationFrame(tick);
});
</script>
</body>
</html>
